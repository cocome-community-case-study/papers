\chapter{Implementation of Evolution Scenarios}
This chapter describes implementation details for realizing the Docker environment \ref{DockerImplementation}, the Mobile App Client  for the existing hybrid cloud-based variant of CoCoME (\ref{AppImplementation}) and the Microservice-based variant (\ref{MicroserviceImplementation}).


\section{Using a Docker Environment}\label{DockerImplementation}
 	As shown in figure \ref*{Deploym_CoCoME} the docker Container contains five different Glassfish servers. In particular they are called \textit{WEB}, \textit{ENTERPRISE}, \textit{STORE}, \textit{REGISTRY} and \textit{ADAPTER} and correspond to the given by the CoCoME deplyoment setup. By default, Glassfish provides a Derby DB that is connected to the server Adapter using Java Database Conectivity (JDBS) interface.\\
 	\begin{figure}[h]
 		\centering
 		\includegraphics[width = 0.8\textwidth]{img/docker_Container_Deployment.png}
 		\caption{Deployment diagram CoCoME}
 		\label{Deploym_CoCoME}
 	\end{figure}
 	
 	CoCoME is deployed inside the docker container on the same way it is usually deployed. This means the maven generated archive files \textit{cloud-web-frontend},\textit{enterprise-logic-ear},\textit{store-logic-ear}\textit{cloud-registry-sevice} and \textit{service-adapter-ear} are deployed to the servers with the following assignment:
 	\begin{figure}[H]
 		\centering
 		\begin{tabular}{p{0.25\textwidth}|p{0.01\textwidth}p{0.25\textwidth}}
 			Server && Deployment file \\
 			\hline
 			WEB && cloud-web-frontend  \\
 			ENTERPRISE && enterprise-logic-ear  \\
 			STORE && store-logic-ear  \\
 			REGISTRY && cloud-registry-service  \\
 			ADAPTER && service-adapter-ear \\	
 		\end{tabular}
 		\caption{Assignment of archive files to Servers}
 		\label{table_assignment}
 	\end{figure}
 	\ref{table_assignment} demonstrates the assignment between the archive files and the servers as it is implemented and also recommended by the CoCoME deployment guide. This information is also represented in Fig. 2. As mentioned earlier, there are two versions of this Docker project. Both deploy the CoCoME main program with this assignment.\\ \\
 	
 	In addition, the fast version can be extends by the pickup shop\footnote{\url{https://github.com/cocome-community-case-study/cocome-cloud-jee-web-shop}}. This pickup-shop runs inside a separate container which is shown in figure \ref{Deploym_Pickup}.  
 	\begin{figure}[h]
 		\centering
 		\includegraphics[width = 0.4\textwidth]{img/docker_Container_PickUP.png}
 		\caption{Deployment diagram CoCoME Pickup Shop}
 		\label{Deploym_Pickup}
 	\end{figure}
 	As shown in figure \ref*{Deploym_Pickup}, this container provides only one Glassfish server.
 	\begin{figure}[H]
 		\centering
 		\begin{tabular}{p{0.25\textwidth}|p{0.01\textwidth}p{0.25\textwidth}}
 			Server && Deployment file \\
 			\hline
 			PICKUP\_SHOP && cocome-pickup-war \\	
 		\end{tabular}
 		\caption{Assignment archive files to Servers}
 		\label{table_assignment_pickup}
 	\end{figure}
 	To control the start of both containers, precisely the CoCoME and the Pick Up Shop, another specific file is needed: the Docker Compose file. It ensures that the CoCoME Container is active, before the pickup-shop container is starting. This is necessary as the Pickup Shop requires a running instance of CoCoME to register itself.\\
 	Also CoCoME runs without the pickup-shop, the pickup-shop does not work without an running instance of CoCoME.\\
 	Both containers need to communicate with each other. By default, docker prohibits any outgoing and ingoing communication from an in a container. This is solved by opening specific ports through which the communication is possible. Which ports the containers can use is specified in the Docker Compose file as well.
 	
 	
 \section{Adding a Mobile App Client}\label{AppImplementation}
 Adding a Mobile App Client did not require a modification within the hybrid cloud-based variant of CoCoME \cite{HeinrichRostamiReussner2016_1000052688}. The implementation was done using the Cordova framework and OnsenUI to provide a multi OS compatible backend and UI \cite{schnabel}. The App itself is written in Typescript/Javascript. Fig. \ref{App_ClassDiagram} shows the principal classes and their relationships.
 \\
  The \textit{Navigator} is the primary class that manages the pages. The pages consist of two components: The \textit{Page} itself and its \textit{PageState}. The \textit{PageState} is used to store and transfer the current status of a page. There are currently six different pages available: \textit{IndexPage}, \textit{SearchPage}, \textit{ItemPage}, \textit{CheckoutPage}, \textit{CartPage} and \textit{LoginPage}. For the sake of clarity, they are subsumed under the generic terms \textit{ConcretePage} and \textit{ConcretePageState}. 
  \\
  Pages use components. Such components are i.e. the \textit{Navbar} or the \textit{Searchbar}. These components are abstract descriptions of UI elements that are connected to the actual \textit{HTML-elements} via Knockout.js. By using Knockout.js, changing values of a component results in an immediate change of the UI. 
  Besides, the App Client retrieves information of the CoCoME system.  As mentioned in \ref{DesignMobileApp}, the Client is not able to access the CoCoME system directly. Therefore, the pages use \textit{Services} provided by a \textit{ServiceHolder} to call the \textit{AppController'} Rest-API. The \textit{AppController} is written in Java using the SpringBoot framework and converts the Rest-requests of the App Client to SOAP-Requests in order to match the CoCoME-API. 
  
  
   \begin{sidewaysfigure}[ht]
  	\includegraphics[width=\textwidth]{img/appBasicClass.png}
  	\caption{Primary Classes of the App}
  	\label{App_ClassDiagram}
  \end{sidewaysfigure}

\FloatBarrier
 
 
 \section{Using Microservice Technology}\label{MicroserviceImplementation}
 
\begin{figure}[h]
	\includegraphics[width = \textwidth]{img/seqProductCreate.png}
	\caption{Sequenze Diagram for creation of new Products}
	\label{seqCreateProduct}
\end{figure}

\begin{figure}[h]
	\includegraphics[width = \textwidth]{img/SeqProductOrderEntry.png}
	\caption{Sequenze Diagram for creation of new Product Orders}
	\label{seqProductOrder}
\end{figure}